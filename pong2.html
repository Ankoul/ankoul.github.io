<html>
<head></head>
<body>
<!-- v1.1 -->
<canvas id="gc" width="400" height="600"></canvas>
<span>Velocidade:<span id="speed">1</span></span>
<span>Velocidade Maxima:<span id="maxSpeed">1</span></span>
<script>
try{
gameVelocity = 15;
gameIntervalId=0;
window.onload = function(){
	speed=document.getElementById("speed");
	maxSpeed=document.getElementById("maxSpeed");
	maxSpeed.innerHTML = localStorage.getItem("maxSpeed") || 1;
	canv=document.getElementById("gc");
	ctx=canv.getContext("2d");
	document.addEventListener("keydown",keyPush);
	document.addEventListener("keyup",keyUp);
	gameIntervalId = setInterval(test,1000/gameVelocity);
	setInterval(function(){
		console.log("velodidade++")
		clearInterval(gameIntervalId);
		gameVelocity+=2;
		gameIntervalId = setInterval(test,1000/gameVelocity);
		speed.innerHTML++;
		if(parseInt(speed.innerHTML) > parseInt(maxSpeed.innerHTML)){
			localStorage.setItem("maxSpeed",speed.innerHTML);
			maxSpeed.innerHTML = speed.innerHTML;
		}
	},20000);
	
}
KEY_LEFT=37;
KEY_RIGHT=39;
KEY_D=68;
KEY_A=65;
positionX=positionY=10;
squareSize=20;// tamanho de um quadrado em pixels
board = {width:20,height:30};
foodX=foodY=9;
directionX=directionY=0;
player1 = {
	x:7,
	y:29,
	size:6,
	directionX:0
};
player2 = {
	x:7,
	y:0,
	size:6,
	directionX:0
};
ball = {
	x:10,
	y:15,
	size:1,
	direction:{x:1,y:1},
	isMovingUp: function(){return ball.direction.y < 0;},
	isMovingDown: function(){return ball.direction.y > 0;}
};
function test(){

	drawBoard();
	
	movePlayer(player1);
	drawPlayer(player1);
	
	movePlayer(player2);
	drawPlayer(player2);
	
	moveBall();
	drawBall();
}
function drawBoard(){
	ctx.fillStyle = "black";
	ctx.fillRect(0,0,canv.width,canv.height);
}
function movePlayer(player){
	player.x += player.directionX;
	if(overflowLeft(player)){
		player.x= 0;
		stopMovePlayer(player);
	} else if(overflowRight(player)){
		player.x= board.width-player.size;
		stopMovePlayer(player);
	}
}
function drawPlayer(player){
	ctx.fillStyle = "red";
	ctx.fillRect(player.x*squareSize,player.y*squareSize,player.size*squareSize-2,squareSize-2);
}
function moveBall(){
	ball.x += ball.direction.x;
	ball.y += ball.direction.y;
	if(playerHitBall()){
		ball.direction.y = -(ball.direction.y);
		//ball.direction.x = -(ball.direction.x);
	} else if(overflowBottom(ball) || overflowTop(ball)){
		resetBallPosition();
		speed.innerHTML = 1;
		gameVelocity = 15;
	} else if(overflowRight(ball) || overflowLeft(ball)){
		ball.direction.x = -(ball.direction.x);
	}
}
function resetBallPosition(){
		ball.x = 10;
		ball.y = 15;
}

function playerHitBall(){
	if(ball.isMovingDown()){
		return ball.x+ball.size > player1.x && ball.x < player1.x+player1.size && ball.y+ball.size >= player1.y;
	} else if (ball.isMovingUp()){
		return ball.x+ball.size > player2.x && ball.x < player2.x+player2.size && ball.y <= player2.y+1;
	}
}
function drawBall(){
	ctx.fillStyle = "yellow";
	ctx.fillRect(ball.x*ball.size*squareSize,ball.y*ball.size*squareSize,ball.size*squareSize,ball.size*squareSize);
}
function keyPush(event){
	switch(event.keyCode){
		case KEY_LEFT: movePlayerToleft(player1); break; 
		case KEY_RIGHT: movePlayerToRight(player1); break; 
		case KEY_D: movePlayerToRight(player2); break; 
		case KEY_A: movePlayerToleft(player2); break; 
		default: console.log(event.keyCode);
	}
}
function keyUp(){
	switch(event.keyCode){
		case KEY_LEFT: stopMovePlayer(player1); break; 
		case KEY_RIGHT: stopMovePlayer(player1); break; 
		case KEY_D: stopMovePlayer(player2); break; 
		case KEY_A: stopMovePlayer(player2); break; 
		default: console.log(event.keyCode);
	}
}
function stopMovePlayer(player){
	player.directionX=0;
}

function movePlayerToleft(player){
		player.directionX-=2;
}
function movePlayerToRight(player){
		player.directionX+=2;
}
function overflowLeft(player){ return player.x<=0; }
function overflowTop(ball){ return ball.y<0; }
function overflowRight(player){ return player.x+player.size>board.width-1; }
function overflowBottom(ball){ return ball.y>board.height-1; }



} catch(e){
	console.log(e);
}
</script>
</body>
</html>